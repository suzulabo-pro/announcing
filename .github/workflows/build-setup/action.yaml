inputs:
  SECRET_VALUES:
    required: true

outputs:
  BUILD_NUMBER:
    value: ${{ steps.build_version.outputs.BUILD_NUMBER }}
  APP_VERSION:
    value: ${{ steps.build_version.outputs.APP_VERSION }}
  FIREBASE_APP_ID_ANDROID:
    value: ${{ steps.extract_secrets.outputs.FIREBASE_APP_ID_ANDROID }}
  FIREBASE_APP_ID_IOS:
    value: ${{ steps.extract_secrets.outputs.FIREBASE_APP_ID_IOS }}
  AD_HOC_PROVISION_NAME:
    value: ${{ steps.extract_secrets.outputs.AD_HOC_PROVISION_NAME }}
  AD_HOC_APPID:
    value: ${{ steps.extract_secrets.outputs.AD_HOC_APPID }}

runs:
  using: 'composite'

  steps:
    - run: npm i -g npm@7
      shell: bash

    - run: npm ci
      shell: bash

    - id: unpack_secrets
      run: npm run - secrets.unpack
      shell: bash
      env:
        SECRET_VALUES: ${{ inputs.SECRET_VALUES }}

    - run: npm run - secrets.copy
      shell: bash

    - id: build_version
      run: node .github/workflows/build_version.js
      shell: bash
